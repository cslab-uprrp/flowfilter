#Introduction

High performance data networks such as Science DMZ [1] networks are being deployed in research institutions all over the nation to provide high speed big data transfer among intra and inter institutional collaborations.  The amount of network data generated by such networks is very costly to store and/or process to provide network security, network situational awareness, and network forensics. These research networks can not rely their security on traditional firewalls because firewalls tend deter the data transfer performance. The use of network flows have become more popular to aid provide network security to such networks.

### What is a network flow?
A network flow is a sequence of packets from a source computer to a destination, which may be another host, a multicast group, or a broadcast domain [2]. These network flows consist of a source and destination IP, source and destination port, the aggregated amount of packets sent, the aggregated amount of bytes sent, the input and output interfaces, among others. Network flows are used for network situational awareness, i.e. to keep track of what is happening in the network, to detect network anomalies, and for network forensics [3].

### Our goal
The goal of this research is to create an API that allow system administrators to manage network flows data in the web, to provide a bridge between the processing of big network data and visualization analytics researchers and provide network analysis as a web service in the cloud. 

### Used frameworks

Our API uses  AngularJS and Silk. AngularJS is a JavaScript framework which extends HTML attributes such that you can generate dynamic views in web-applications. SiLK, the System for Internet-Level Knowledge, is a collection of traffic analysis tools developed by the CERT Network Situational Awareness Team (CERT NetSA) to facilitate security analysis of large networks. The SiLK tool suite supports the efficient collection, storage, and analysis of network flow data, enabling network security analysts to rapidly query large historical traffic data sets [4].  

#Installation

The following prerequisites must be installed in order to have the API working in your server:

* [Silk](https://tools.netsa.cert.org/silk/download.html)
* [Netaddr](https://pypi.python.org/pypi/netaddr) 

###Edit the configuration files

The following process is the same for Python and Javascript developers. The only difference is that if you are a Javascript developer then you are going to be using the `apiJS` folder instead of `api`.  

1. **config.js**
- Change directory to the Style folder inside the api: ```api/Style/```
- Edit the ```config.js``` file: `vi api/Style/config.js`
	- Change the url in the following variables to your own:
		- `appJsUrl`
		- `cssUrl`
		- `engineUrl`

2. **config.py**
- Change directory to the api folder: `api/`
- Edit the `config.py` file: `vi api/config.py`
	- Change the path in the following variables to your own:
		- `site_config_file`
		- `data_rootdir`

###Engines
The engine `engine.cgi` is the file in which you will be calling the API to process and apply the filters, entered by the user, to the flows. 

This file contains the necessary function calls to:

   - print the filter selector page (`printFilterPage`) **_Only Python developers_**
   - receive the data and retrieve the needed values from it (`receiveData`)
   - process the user's query and return the array of flows and the path of the file in which the resulting flows were saved (`processData`)

**_You are not supposed to remove this function calls unless knowing what you are doing_**

Besides these calls, in the file you will find a main `if statement` like this:

```
	if form.has_key("data"):
		some_code
	elif form.has_key("entries"):
		some\_other\_code
	else:
		printFilterPage()
		print "There is no filter..."
```

**Basically this is how it works:** **if** the form has the key **_"data"_** then it means that the engine file is being called for the first time and it will process the query, apply the filters to the flows and return the result. **Else if** the form has the key **_"entries"_** then it means that this is not the first call of the engine file and therefore the user is asking for the next chunk of flows, since we are just returning pieces of the result to gain efficiency. If the form does not has any of these keys then it means that the engine is being accessed using the direct url and therefore there are no filters to apply to the flows. 

####Selecting the format of the IPs in the resulting json

When the API is done filtering the flows and we have a resulting array, we construct a json to return to the user. At this moment you can choose in which format you want the source and destination IPs to be saved. You can choose this by calling one of the following function to construct the desire json:

   - `toJson`: As they come (ipv4 or ipv6)
   - `toJsonInt`: As they come (ipv4 or ipv6) converted to int
   - `toJsonInt4`: Just ipv4 converted to int
   - `toJsonInt6`: Just ipv6 converted to int


Whichever you choose, remember to be consistent by using the same function in the entire code, the _data_ and the _entries_ part of the `if statement`. 

After choosing the format, just pass the json, and any other information needed, to your visualization. The `showViz()` function will display the visualization for you.

<!-- The only thing that you need to worry about this file is the format in which you want to receive the data for your visualization. Let me explain myself. -->

